# -----------------------
# ðŸ”¨ BÆ¯á»šC 1: Build app
# -----------------------
FROM node:18-alpine AS builder

# Táº¡o thÆ° má»¥c lÃ m viá»‡c
WORKDIR /app

# Copy file cáº¥u hÃ¬nh trÆ°á»›c Ä‘á»ƒ táº­n dá»¥ng cache
COPY package*.json ./

# CÃ i dependencies (cáº£ dev vÃ  prod Ä‘á»ƒ trÃ¡nh lá»—i thiáº¿u module khi build)
RUN npm install

# Copy toÃ n bá»™ source vÃ o container
COPY . .

# -----------------------------
# ðŸš€ BÆ¯á»šC 2: Image tá»‘i giáº£n Ä‘á»ƒ cháº¡y
# -----------------------------
FROM node:18-alpine

# Táº¡o thÆ° má»¥c cháº¡y app
WORKDIR /app

# Copy code Ä‘Ã£ cÃ i sáºµn module tá»« builder
COPY --from=builder /app ./

# Chá»‰ Ä‘á»‹nh cá»•ng cháº¡y (tuá»³ thuá»™c app báº¡n cháº¡y port nÃ o, 5000?)
EXPOSE 5000

# Lá»‡nh khá»Ÿi cháº¡y server
CMD ["node", "server.js"]
